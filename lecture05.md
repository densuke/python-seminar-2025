---
marp: true
theme: style
size: 16:9
paginate: true
---

# Pythonセミナー 第5回

## docstringとdoctest

---

## この時間に学ぶこと

- docstring（ドキュメンテーション文字列）の重要性と役割を理解する
- Googleスタイルに沿った、分かりやすいdocstringの書き方を習得する
- docstring内にテストコードを記述する`doctest`の基本的な使い方を学ぶ
- ドキュメントとテストを一体化させるメリットを体験する

---

## docstringとは？

関数やクラス、モジュールの定義の直後に書かれる、`"""`（トリプルクォート）で囲まれた文字列のことです。

そのオブジェクトが **「何をするものなのか」** を説明する、公式なドキュメントとして機能します。

**コード例: `05/docstring_basic.py`**

```python
def add(a, b):
    """二つの数値を足し算して返す関数。"""
    return a + b

# help(add) などで説明が表示される
```

---

## なぜdocstringが重要なのか？

- **未来の自分へのメモ**: 数ヶ月後にコードを見返したとき、何をする関数だったかすぐに思い出せます。
    - 数ヶ月後? 明日でもわからなくなっているのが現実です!
- **チームメンバーとの共通言語**: 他の人があなたのコードを理解する手助けになります。
- **ドキュメント自動生成**: `Sphinx`などのツールで、APIリファレンスを自動生成できます。
- **対話的ヘルプ**: `help()`関数や`__doc__`属性で、その場で使い方を確認できます。

---

## 良いコードとdocstringの関係

**良いコードは、それ自体がドキュメントであるべきですが、docstringはその意図を補強する重要な役割を果たします。**

---

## Googleスタイル docstring

docstringにはいくつかの書き方の流派（スタイル）がありますが、Googleスタイルは非常に読みやすく、広く使われています。

**主な構成要素:**
- **要約**: 関数が何をするかを一行で簡潔に記述。
- **Args**: 各引数の説明（名前、型、説明）。
- **Returns**: 戻り値の説明（型、内容）。
- **Raises**: 送出する可能性のある例外の説明。

---

## Googleスタイルの例

**コード例: `05/google_style_docstring.py`** ※全文は資料ソースを参照

```python
from typing import Optional

def get_user(user_id: int) -> Optional[dict]:
    """指定されたIDのユーザー情報をデータベースから取得します。

    Args:
        user_id: 取得対象のユーザーID。

    Returns:
        ユーザー情報を含む辞書。ユーザーが見つからない場合はNoneを返します。

    Raises:
        ConnectionError: データベースへの接続に失敗した場合。
    """
    # ... (実際の処理)
    pass
```

---

## `doctest`とは？

`doctest`は、docstringの中に書かれた**対話的な実行例**を、そのままテストとして実行する機能です。

- ドキュメントが常に正しいことを保証できる
- 関数の基本的な使い方の例を、テストファイルを別途作成する手間が省ける

---

## `doctest`の書き方

Pythonの対話モード（`>>>`）の形式で、実行例と期待される結果を記述します。

**コード例: `05/doctest_example.py`**

```python
def add(a, b):
    """二つの数を足し算します。

    >>> add(2, 3)
    5
    >>> add(-1, 1)
    0
    """
    return a + b
```

---

## `doctest`の実行方法

コマンドラインから、`-m doctest`オプションを付けて実行します。

**コマンド例: `05/doctest_run_example.py`**

```powershell
uv run -m doctest -v 05/doctest_example.py               
```

- `-v` (verbose) オプションを付けると、各テストの結果が詳しく表示されます。
- 何も出力されなければ、全てのテストが成功したということです。

---

## 5時間目のまとめ

- docstringは、コードの意図を伝えるための重要なドキュメントである
- Googleスタイルは、引数や戻り値が分かりやすく、おすすめの書き方
- `doctest`を使うと、docstring内の実行例をテストとして実行できる
- ドキュメントとテストを一体化させることで、ドキュメントの正確性を保ち、コードの品質を向上させることができる
